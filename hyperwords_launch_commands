How to make spectral clustering great again:
1/ Similarity matrix - thresholded PMI with different windows
2/ Laplacians - symmetric normalized
3/ Eigenweighting - none, commute time, deepwalk (gives small improvements)
4/ Similarity measures - cos, l2, log cos, log l2 (mostly cos)

Try SVD on PMI matrix - it should not be very different from what we're learning in laplacians.
Maybe because we learn algebraically largest eigenpairs and not by magnitude?

Ideas for tuning / speeding-up:
1/ Different PMIs - https://aclanthology.info/pdf/W/W13/W13-3503.pdf
2/ Preconditioners - max-weight spanning tree or forest
3/ Less precision

export OUTPUT_DIR=/Users/i.lobov/hyperwords/data/wiki
export CORPUS=wikipedia.corpus.nodups
bash scripts/clean_corpus.sh $OUTPUT_DIR/$CORPUS > $OUTPUT_DIR/$CORPUS.clean

export CORPUS2PAIRS_OPTS="--thr 100 --win 2 --del"
pypy hyperwords/corpus2pairs.py $CORPUS2PAIRS_OPTS $OUTPUT_DIR/$CORPUS.clean > $OUTPUT_DIR/${CORPUS}_pairs_win=2
bash scripts/pairs2counts.sh $OUTPUT_DIR/${CORPUS}_pairs_win=2 > $OUTPUT_DIR/${CORPUS}_counts_win=2
python hyperwords/counts2vocab.py $OUTPUT_DIR/${CORPUS}_counts_win=2

export counts=/Users/i.lobov/hyperwords/data/wiki/wikipedia.corpus.nodups_counts_win=1
export out=/Users/i.lobov/hyperwords/data/wiki/wikipedia.corpus.nodups_win=1_pmi
python counts2pmi.py $counts $out

export OUTPUT_DIR=/Users/i.lobov/hyperwords/data/wiki
export WORD2VECF_OPTS="-pow 1 -size 100 -negative 1 -threads 3 -iters 1"
export OUTPUT_NAME=sgns_d=300_win=1_neg=5_iter=1
word2vecf/word2vecf $WORD2VECF_OPTS -train $OUTPUT_DIR/wikipedia.corpus.nodups_pairs_win=1 -cvocab $OUTPUT_DIR/wikipedia.corpus.nodups_counts_win=1.words.vocab -wvocab $OUTPUT_DIR/wikipedia.corpus.nodups_counts_win=1.words.vocab -dumpcv $OUTPUT_DIR/$OUTPUT_NAME.contexts -output $OUTPUT_DIR/$OUTPUT_NAME.words
python hyperwords/text2numpy.py $OUTPUT_DIR/$OUTPUT_NAME.words
python hyperwords/text2numpy.py $OUTPUT_DIR/$OUTPUT_NAME.contexts

python hyperwords/utils/corpus2adjacency_matrix.py --win 5 --thr 1 ./data/wiki/wiki.test


python -m hyperwords.utils.learn_spectral_embeddings --pow 0.0 --verbosity 1 /Users/i.lobov/hyperwords/data/wiki/wikipedia.corpus.nodups_counts_win=1 symmetric_normalized /Users/i.lobov/hyperwords/data/wiki/win=1_highest_prec

### Evaluate on word similarity task

python -m hyperwords.utils.find_rhoB /Users/i.lobov/hyperwords/data/wiki/wikipedia.corpus.nodups_counts_win=1

python -m hyperwords.utils.test_derivative /Users/i.lobov/hyperwords/data/wiki/wikipedia.corpus.nodups_counts_win=1

python -m hyperwords.utils.eval_all /Users/i.lobov/hyperwords/data/wiki/win=1_weighted_bethe_hessian_slepc_max_scaling_pow=0.3_dim=100 /Users/i.lobov/hyperwords/testsets/ws/ /Users/i.lobov/hyperwords/testsets/analogy/



python hyperwords/ws_eval.py SGNS /Users/i.lobov/hyperwords/data/wiki/deps testsets/ws/ws353.txt
0.613

python hyperwords/ws_eval.py SPECTRAL /Users/i.lobov/hyperwords/data/wiki/eigenscaled_d=500 testsets/ws/ws353.txt
python hyperwords/ws_eval.py SPECTRAL /Users/i.lobov/hyperwords/data/wiki/eigenscaled_d=500 testsets/ws/ws353_relatedness.txt
python hyperwords/ws_eval.py SPECTRAL /Users/i.lobov/hyperwords/data/wiki/eigenscaled_d=500 testsets/ws/ws353_similarity.txt
python hyperwords/ws_eval.py SPECTRAL /Users/i.lobov/hyperwords/data/wiki/eigenscaled_d=500 testsets/ws/radinsky_mturk.txt
python hyperwords/ws_eval.py SPECTRAL /Users/i.lobov/hyperwords/data/wiki/eigenscaled_d=500 testsets/ws/luong_rare.txt
python hyperwords/ws_eval.py SPECTRAL /Users/i.lobov/hyperwords/data/wiki/eigenscaled_d=500 testsets/ws/bruni_men.txt

python hyperwords/analogy_eval.py SPECTRAL /Users/i.lobov/hyperwords/data/wiki/eigenscaled_d=500 testsets/analogy/google.txt
python hyperwords/analogy_eval.py SPECTRAL /Users/i.lobov/hyperwords/data/wiki/eigenscaled_d=500 testsets/analogy/msr.txt

python hyperwords/analogy_eval.py SPECTRAL /Users/i.lobov/hyperwords/data/wiki/spectral_embeddings_d=300 testsets/analogy/google.txt
python hyperwords/analogy_eval.py SPECTRAL /Users/i.lobov/hyperwords/data/wiki/spectral_embeddings_d=300 testsets/analogy/msr.txt
